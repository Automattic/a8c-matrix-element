(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{1627:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return D}));var o=t(130),r=t.n(o),c=t(133),a=t.n(c),l=t(120),s=t.n(l),i=t(124),u=t(127),d=t(138),f=t(238),m=t(412),b=t(342),p=t(318),g=t(413);var h=t(949),O=t(126),C=t.n(O);var v=t(942);var j=t(167),T=t(201);const R=["node","startOffset","endOffset"];const x=e=>{if(null===e)return null;{const{node:n,startOffset:t,endOffset:o}=e;return a()(e,R)}},y=(e,n,t,o)=>{var r;if(null===n)return;const{node:c}=n,a=`${e} `;c.textContent=a,null===(r=document.getSelection())||void 0===r||r.setBaseAndExtent(c,a.length,c,a.length),o(a),t(null)},E=(e,n,t)=>{var o;const r=document.getSelection();if(null===e.current||null===r||!r.isCollapsed||"#text"!==(null===(o=r.anchorNode)||void 0===o?void 0:o.nodeName))return;const{anchorNode:c}=r;if(c!==document.createNodeIterator(e.current,NodeFilter.SHOW_TEXT).nextNode()||null===c.textContent)return;const a=c.textContent.match(/^\/(\w*)$/);null!==a?t({keyChar:"/",type:"command",text:a[1],node:r.anchorNode,startOffset:0,endOffset:c.textContent.length}):null!==n&&t(null)};function S(e,n,t){const o=Object(l.useRef)(null),r=Object(l.useRef)(null),[c,a]=Object(l.useState)(e),s=Object(l.useCallback)((()=>{o.current&&(o.current.innerHTML=""),null==t||t()}),[o,t]),i=Object(l.useCallback)((e=>{a(e),null==n||n(e)}),[n]),{suggestion:u,onSelect:d,handleCommand:f,handleMention:b}=function(e,n){const[t,o]=Object(l.useState)(null);return{suggestion:x(t),handleCommand:e=>y(e,t,o,n),handleMention:()=>{},onSelect:()=>E(e,t,o)}}(o,i),p=!Object(j.b)("MessageComposerInput.ctrlEnterToSend"),g=Object(l.useCallback)((e=>{if(e.target instanceof HTMLDivElement){const n=p?e.target.innerHTML:e.target.innerHTML.replace(/<div><br><\/div>/g,"\n").replace(/<div>/g,"\n").replace(/<\/div>/g,"");i(n)}}),[i,p]),h=Object(l.useCallback)((e=>{if(!Object(m.b)(r,e)&&e.key===T.b.ENTER){const n=T.a?e.metaKey:e.ctrlKey;p&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),s()),!p&&n&&(e.preventDefault(),e.stopPropagation(),s())}}),[r,p,s]);return{ref:o,autocompleteRef:r,onInput:g,onPaste:g,onKeyDown:h,content:c,setContent:i,suggestion:u,onSelect:d,handleCommand:f,handleMention:b}}var M=t(941),k=t(961),w=t(976);function N(e){let{className:n,disabled:t=!1,onSend:o,onChange:r,children:c,placeholder:a,initialContent:i,leftComponent:u,rightComponent:d}=e;const{ref:f,autocompleteRef:m,onInput:b,onPaste:p,onKeyDown:h,content:O,setContent:j,suggestion:T,onSelect:R,handleCommand:x,handleMention:y}=S(i,r,o),E=function(e,n){return Object(l.useMemo)((()=>({clear:()=>{e.current&&(e.current.innerHTML="")},insertText:t=>{const o=document.getSelection();if(e.current&&o){const r=e.current.innerHTML,{anchorOffset:c,focusOffset:a}=o;e.current.innerHTML=`${r.slice(0,c)}${t}${r.slice(a)}`,Object(g.d)({anchorNode:e.current.firstChild,anchorOffset:c+t.length,focusNode:e.current.firstChild,focusOffset:a+t.length,isForward:!0}),n(e.current.innerHTML)}}})),[e,n])}(f,j);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;Object(l.useEffect)((()=>{n.current&&(n.current.innerText=e)}),[n,e])}(i,f),Object(M.a)(t,f);const{isFocused:N,onFocus:P}=Object(v.a)(),F=!O&&a||void 0;return s.a.createElement("div",{"data-testid":"PlainTextComposer",className:C()(n,{[`${n}-focused`]:N}),onFocus:P,onBlur:P,onInput:b,onPaste:p,onKeyDown:h,onSelect:R},s.a.createElement(w.a,{ref:m,suggestion:T,handleMention:y,handleCommand:x}),s.a.createElement(k.a,{ref:f,disabled:t,leftComponent:u,rightComponent:d,placeholder:F}),null==c?void 0:c(f,E))}var P=t(268),F=t(928);function H(e){let{menuPosition:n}=e;const t=Object(d.c)();return s.a.createElement(F.a,{menuPosition:n,addEmoji:e=>(i.a.dispatch({action:u.a.ComposerInsert,text:e,timelineRenderingType:t.timelineRenderingType}),!0)})}const I=["isRichTextEnabled","e2eStatus","menuPosition","eventRelation"],L=Object(l.forwardRef)((function(e,n){let{disabled:t=!1,composerFunctions:o}=e;return function(e,n,t){const o=Object(d.c)(),r=Object(p.c)(),c=Object(l.useRef)(null),a=Object(l.useCallback)((a=>{var l;if(e||null==n||!n.current)return;const s=null!==(l=a.context)&&void 0!==l?l:d.a.Room;switch(a.action){case"reply_to_event":case u.a.FocusAComposer:case u.a.FocusSendMessageComposer:Object(m.a)(n,s,o,c);break;case u.a.ClearAndFocusSendMessageComposer:if(a.timelineRenderingType!==o.timelineRenderingType)break;t.clear(),Object(m.a)(n,s,o,c);break;case u.a.ComposerInsert:if(a.timelineRenderingType!==o.timelineRenderingType)break;if(a.composerType!==b.a.Send)break;a.userId||a.event||a.text&&Object(g.d)(r.selection).then((()=>t.insertText(a.text)))}}),[e,n,o,t,r]);Object(f.a)(i.a,a)}(t,n,o),null}));function D(e){let{isRichTextEnabled:n,e2eStatus:t,menuPosition:o,eventRelation:c}=e,i=a()(e,I);const u=n?h.a:N,d=Object(l.useRef)(Object(p.b)({eventRelation:c}));return s.a.createElement(p.a.Provider,{value:d.current},s.a.createElement(u,r()({className:"mx_SendWysiwygComposer",leftComponent:t&&s.a.createElement(P.b,{status:t}),rightComponent:s.a.createElement(H,{menuPosition:o})},i),((e,n)=>s.a.createElement(L,{disabled:i.disabled,ref:e,composerFunctions:n}))))}}}]);
//# sourceMappingURL=41.js.map