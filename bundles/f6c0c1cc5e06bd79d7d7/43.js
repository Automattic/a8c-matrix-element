(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1547:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var o=n(18),r=n.n(o),c=n(26),l=n.n(c),a=n(0),i=n.n(a),s=n(8),u=n(13),d=n(31),f=n(607),m=n(1281),b=n(413),p=n(1268),g=n(1282);var h=n(1397),O=n(12),v=n.n(O);var C=n(1341);var j=n(174),T=n(22),x=n(290);function S(e,t){var n;const[o,r]=Object(a.useState)(null);return{suggestion:null!==(n=null==o?void 0:o.mappedSuggestion)&&void 0!==n?n:null,handleCommand:e=>function(e,t,n,o){var r;if(null===t)return;const{node:c}=t,l=`${e} `;c.textContent=l,null===(r=document.getSelection())||void 0===r||r.setBaseAndExtent(c,l.length,c,l.length),o(l),n(null)}(e,o,r,t),handleMention:(e,n,c)=>function(e,t,n,o,r,c){var l,a,i,s;if(null===o)return;const{node:u}=o,d=document.createElement("a"),f=document.createTextNode(t);d.setAttribute("href",e),d.setAttribute("contenteditable","false"),Object.entries(n).forEach((e=>{let[t,n]=e;return Object(x.b)(n)&&d.setAttribute(t,n)})),d.appendChild(f);const m=document.createTextNode((null===(l=u.textContent)||void 0===l?void 0:l.slice(0,o.startOffset))||"â€‹"),b=document.createTextNode(` ${null!==(a=null===(i=u.textContent)||void 0===i?void 0:i.slice(o.endOffset))&&void 0!==a?a:""}`),p=u.parentNode;Object(x.a)(p)&&(p.insertBefore(m,u),p.insertBefore(d,u),p.insertBefore(b,u),p.removeChild(u));null===(s=document.getSelection())||void 0===s||s.setBaseAndExtent(b,1,b,1),c(),r(null)}(e,n,c,o,r,t),onSelect:()=>function(e,t){var n;const o=document.getSelection();if(null===e.current||null===o||!o.isCollapsed||"#text"!==(null===(n=o.anchorNode)||void 0===n?void 0:n.nodeName))return void t(null);const{anchorNode:r,anchorOffset:c}=o;if(null===r.textContent)return void t(null);const l=document.createNodeIterator(e.current,NodeFilter.SHOW_TEXT).nextNode(),a=r===l,i=function(e,t,n){if(t<0||t>e.length)return null;let o=t,r=t;for(;y(e,o);)o--;for(;E(e,r);)r++;const c=e.slice(o,r),l=function(e){const t=e.charAt(0),n=e.slice(1);switch(t){case"/":return{keyChar:t,text:n,type:"command"};case"#":case"@":return{keyChar:t,text:n,type:"mention"};default:return null}}(c);if(null===l||"command"===l.type&&(!n||0!==o||r!==e.length))return null;return{mappedSuggestion:l,startOffset:o,endOffset:o+c.length}}(r.textContent,c,a);if(null===i)return void t(null);t({mappedSuggestion:i.mappedSuggestion,node:r,startOffset:i.startOffset,endOffset:i.endOffset})}(e,r)}}function y(e,t){return!(t<=0)&&!/\s/.test(e[t-1])}function E(e,t){return!(t>=e.length)&&!/\s/.test(e[t])}function R(e,t,n){const o=Object(a.useRef)(null),r=Object(a.useRef)(null),[c,l]=Object(a.useState)(e),i=Object(a.useCallback)((()=>{o.current&&(o.current.innerHTML=""),null==n||n()}),[o,n]),s=Object(a.useCallback)((e=>{if(Object(x.b)(e))l(e),null==t||t(e);else if(Object(x.a)(o)&&Object(x.a)(o.current)){const e=o.current.innerHTML;l(e),null==t||t(e)}}),[t,o]),{suggestion:u,onSelect:d,handleCommand:f,handleMention:b}=S(o,s),p=!Object(j.b)("MessageComposerInput.ctrlEnterToSend"),g=Object(a.useCallback)((e=>{if(e.target instanceof HTMLDivElement){const t=p?e.target.innerHTML:e.target.innerHTML.replace(/<div><br><\/div>/g,"\n").replace(/<div>/g,"\n").replace(/<\/div>/g,"");s(t)}}),[s,p]),h=Object(a.useCallback)((e=>{if(!Object(m.b)(r,e)&&e.key===T.b.ENTER){const t=T.a?e.metaKey:e.ctrlKey;p&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),i()),!p&&t&&(e.preventDefault(),e.stopPropagation(),i())}}),[r,p,i]);return{ref:o,autocompleteRef:r,onInput:g,onPaste:g,onKeyDown:h,content:c,setContent:s,suggestion:u,onSelect:d,handleCommand:f,handleMention:b}}var M=n(1340),N=n(1402),k=n(1405);function w(e){let{className:t,disabled:n=!1,onSend:o,onChange:r,children:c,placeholder:l,initialContent:s,leftComponent:u,rightComponent:d}=e;const{ref:f,autocompleteRef:m,onInput:b,onPaste:p,onKeyDown:h,content:O,setContent:j,suggestion:T,onSelect:x,handleCommand:S,handleMention:y}=R(s,r,o),E=function(e,t){return Object(a.useMemo)((()=>({clear:()=>{e.current&&(e.current.innerHTML="")},insertText:n=>{const o=document.getSelection();if(e.current&&o){const r=e.current.innerHTML,{anchorOffset:c,focusOffset:l}=o;e.current.innerHTML=`${r.slice(0,c)}${n}${r.slice(l)}`,Object(g.d)({anchorNode:e.current.firstChild,anchorOffset:c+n.length,focusNode:e.current.firstChild,focusOffset:l+n.length,isForward:!0}),t(e.current.innerHTML)}}})),[e,t])}(f,j);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;Object(a.useEffect)((()=>{t.current&&(t.current.innerText=e)}),[t,e])}(s,f),Object(M.a)(n,f);const{isFocused:w,onFocus:P}=Object(C.a)(),F=!O&&l||void 0;return i.a.createElement("div",{"data-testid":"PlainTextComposer",className:v()(t,{[`${t}-focused`]:w}),onFocus:P,onBlur:P,onInput:b,onPaste:p,onKeyDown:h,onSelect:x},i.a.createElement(k.a,{ref:m,suggestion:T,handleMention:y,handleCommand:S}),i.a.createElement(N.a,{ref:f,disabled:n,leftComponent:u,rightComponent:d,placeholder:F}),null==c?void 0:c(f,E))}var P=n(506),F=n(1342);function H(e){let{menuPosition:t}=e;const n=Object(d.c)();return i.a.createElement(F.a,{menuPosition:t,addEmoji:e=>(s.a.dispatch({action:u.a.ComposerInsert,text:e,timelineRenderingType:n.timelineRenderingType}),!0)})}const L=["isRichTextEnabled","e2eStatus","menuPosition","eventRelation"],A=Object(a.forwardRef)((function(e,t){let{disabled:n=!1,composerFunctions:o}=e;return function(e,t,n){const o=Object(d.c)(),r=Object(p.c)(),c=Object(a.useRef)(null),l=Object(a.useCallback)((l=>{var a;if(e||null==t||!t.current)return;const i=null!==(a=l.context)&&void 0!==a?a:d.a.Room;switch(l.action){case"reply_to_event":case u.a.FocusAComposer:case u.a.FocusSendMessageComposer:Object(m.a)(t,i,o,c);break;case u.a.ClearAndFocusSendMessageComposer:if(l.timelineRenderingType!==o.timelineRenderingType)break;n.clear(),Object(m.a)(t,i,o,c);break;case u.a.ComposerInsert:if(l.timelineRenderingType!==o.timelineRenderingType)break;if(l.composerType!==b.a.Send)break;l.userId||l.event||l.text&&Object(g.d)(r.selection).then((()=>n.insertText(l.text)))}}),[e,t,o,n,r]);Object(f.a)(s.a,l)}(n,t,o),null}));function I(e){let{isRichTextEnabled:t,e2eStatus:n,menuPosition:o,eventRelation:c}=e,s=l()(e,L);const u=t?h.a:w,d=Object(a.useRef)(Object(p.b)({eventRelation:c}));return i.a.createElement(p.a.Provider,{value:d.current},i.a.createElement(u,r()({className:"mx_SendWysiwygComposer",leftComponent:n&&i.a.createElement(P.b,{status:n}),rightComponent:i.a.createElement(H,{menuPosition:o})},s),((e,t)=>i.a.createElement(A,{disabled:s.disabled,ref:e,composerFunctions:t}))))}}}]);
//# sourceMappingURL=43.js.map