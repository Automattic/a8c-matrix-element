(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{1585:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return H}));var o=n(103),r=n.n(o),c=n(106),a=n.n(c),s=n(93),i=n.n(s),l=n(97),u=n(101),d=n(112),b=n(211),f=n(621),m=n(314),p=n(323),O=n(453);var g=n(917),j=n(99),C=n.n(j);var v=n(909);var h=n(141),T=n(178);function E(e,t,n){const o=Object(s.useRef)(null),[r,c]=Object(s.useState)(e),a=Object(s.useCallback)((()=>{o.current&&(o.current.innerHTML=""),null==n||n()}),[o,n]),i=Object(s.useCallback)((e=>{c(e),null==t||t(e)}),[t]),l=!Object(h.b)("MessageComposerInput.ctrlEnterToSend"),u=Object(s.useCallback)((e=>{if(e.target instanceof HTMLDivElement){const t=l?e.target.innerHTML:e.target.innerHTML.replace(/<div><br><\/div>/g,"\n").replace(/<div>/g,"\n").replace(/<\/div>/g,"");i(t)}}),[i,l]),d=Object(s.useCallback)((e=>{if(e.key===T.b.ENTER){const t=T.a?e.metaKey:e.ctrlKey;l&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),a()),!l&&t&&(e.preventDefault(),e.stopPropagation(),a())}}),[l,a]);return{ref:o,onInput:u,onPaste:u,onKeyDown:d,content:r,setContent:i}}var y=n(908),k=n(925);function w(e){let{className:t,disabled:n=!1,onSend:o,onChange:r,children:c,placeholder:a,initialContent:l,leftComponent:u,rightComponent:d}=e;const{ref:b,onInput:f,onPaste:m,onKeyDown:p,content:g,setContent:j}=E(l,r,o),h=function(e,t){return Object(s.useMemo)((()=>({clear:()=>{e.current&&(e.current.innerHTML="")},insertText:n=>{const o=document.getSelection();if(e.current&&o){const r=e.current.innerHTML,{anchorOffset:c,focusOffset:a}=o;e.current.innerHTML=`${r.slice(0,c)}${n}${r.slice(a)}`,Object(O.b)({anchorNode:e.current.firstChild,anchorOffset:c+n.length,focusNode:e.current.firstChild,focusOffset:a+n.length}),t(e.current.innerHTML)}}})),[e,t])}(b,j);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;Object(s.useEffect)((()=>{t.current&&(t.current.innerText=e)}),[t,e])}(l,b),Object(y.a)(n,b);const{isFocused:T,onFocus:w}=Object(v.a)(),M=!g&&a||void 0;return i.a.createElement("div",{"data-testid":"PlainTextComposer",className:C()(t,{[`${t}-focused`]:T}),onFocus:w,onBlur:w,onInput:f,onPaste:m,onKeyDown:p},i.a.createElement(k.a,{ref:b,disabled:n,leftComponent:u,rightComponent:d,placeholder:M}),null==c?void 0:c(b,h))}var M=n(255),P=n(895);function R(e){let{menuPosition:t}=e;const n=Object(d.c)();return i.a.createElement(P.a,{menuPosition:t,addEmoji:e=>(l.a.dispatch({action:u.a.ComposerInsert,text:e,timelineRenderingType:n.timelineRenderingType}),!0)})}const x=["isRichTextEnabled","e2eStatus","menuPosition"],S=Object(s.forwardRef)((function(e,t){let{disabled:n=!1,composerFunctions:o}=e;return function(e,t,n){const o=Object(d.c)(),r=Object(p.c)(),c=Object(s.useRef)(null),a=Object(s.useCallback)((a=>{var s;if(e||null==t||!t.current)return;const i=null!==(s=a.context)&&void 0!==s?s:d.a.Room;switch(a.action){case"reply_to_event":case u.a.FocusSendMessageComposer:Object(f.a)(t,i,o,c);break;case u.a.ClearAndFocusSendMessageComposer:n.clear(),Object(f.a)(t,i,o,c);break;case u.a.ComposerInsert:if(a.timelineRenderingType!==o.timelineRenderingType)break;if(a.composerType!==m.a.Send)break;a.userId||a.event||a.text&&Object(O.b)(r.selection).then((()=>n.insertText(a.text)))}}),[e,t,o,n,r]);Object(b.a)(l.a,a)}(n,t,o),null}));function H(e){let{isRichTextEnabled:t,e2eStatus:n,menuPosition:o}=e,c=a()(e,x);const l=t?g.a:w,u=Object(s.useRef)(Object(p.b)());return i.a.createElement(p.a.Provider,{value:u.current},i.a.createElement(l,r()({className:"mx_SendWysiwygComposer",leftComponent:n&&i.a.createElement(M.b,{status:n}),rightComponent:i.a.createElement(R,{menuPosition:o})},c),((e,t)=>i.a.createElement(S,{disabled:c.disabled,ref:e,composerFunctions:t}))))}}}]);
//# sourceMappingURL=41.js.map